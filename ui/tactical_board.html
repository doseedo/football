<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decision Engine - Tactical Board</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: #eee;
            min-height: 100vh;
        }
        .container {
            display: flex;
            height: 100vh;
            padding: 20px;
            gap: 20px;
        }
        .pitch-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        h1 { font-size: 1.5rem; color: #00d4ff; }
        .controls { display: flex; gap: 10px; }
        button {
            background: #00d4ff;
            color: #1a1a2e;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }
        button:hover { background: #00a8cc; }
        button.secondary { background: #444; color: #eee; }
        #pitch {
            flex: 1;
            background: #2d5a27;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            cursor: crosshair;
        }
        canvas { width: 100%; height: 100%; }
        .instructions {
            font-size: 0.85rem;
            color: #888;
            text-align: center;
        }
        .analysis-panel {
            width: 350px;
            background: #16213e;
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
        }
        .panel-section {
            background: #1a1a2e;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .panel-section h3 {
            color: #00d4ff;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }
        .stat-label { color: #888; }
        .stat-value { font-weight: 600; }
        .stat-value.positive { color: #4ade80; }
        .stat-value.negative { color: #f87171; }
        .gap-item {
            background: #222;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 8px;
            border-left: 3px solid #fbbf24;
        }
        .gap-item.exploitable { border-left-color: #4ade80; }
        .option-item {
            background: #222;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 8px;
        }
        .option-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .option-type { font-weight: 600; font-size: 0.85rem; }
        .option-rec {
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .option-rec.AVOID { background: #f87171; color: #000; }
        .option-rec.SAFE { background: #00d4ff; color: #000; }
        .option-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            font-size: 0.8rem;
            color: #888;
        }
        .toggle-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }
        .toggle-switch { position: relative; width: 44px; height: 24px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider {
            position: absolute; cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #444; transition: 0.3s; border-radius: 24px;
        }
        .toggle-slider:before {
            position: absolute; content: "";
            height: 18px; width: 18px; left: 3px; bottom: 3px;
            background-color: white; transition: 0.3s; border-radius: 50%;
        }
        input:checked + .toggle-slider { background-color: #00d4ff; }
        input:checked + .toggle-slider:before { transform: translateX(20px); }
    </style>
</head>
<body>
    <div class="container">
        <div class="pitch-container">
            <div class="header">
                <h1>Decision Engine - Tactical Board</h1>
                <div class="controls">
                    <button onclick="analyze()">Analyze</button>
                    <button class="secondary" onclick="reset()">Reset</button>
                </div>
            </div>
            <div id="pitch">
                <canvas id="canvas"></canvas>
            </div>
            <p class="instructions">Click to move ball | Drag players to reposition</p>
        </div>

        <div class="analysis-panel">
            <div class="panel-section">
                <h3>Display Options</h3>
                <div class="toggle-row">
                    <span>Show Gaps</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showGaps" checked onchange="render()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="toggle-row">
                    <span>Show Best Option</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showBest" checked onchange="render()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="panel-section">
                <h3>Ball Position</h3>
                <div class="stat-row">
                    <span class="stat-label">Location</span>
                    <span class="stat-value" id="ballPos">(-5.0, 0.0)</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">xG Zone</span>
                    <span class="stat-value" id="xgZone">0.023</span>
                </div>
            </div>

            <div class="panel-section">
                <h3>Defensive Gaps</h3>
                <div id="gapsList"></div>
            </div>

            <div class="panel-section">
                <h3>Top Options</h3>
                <div id="optionsList"></div>
            </div>
        </div>
    </div>

    <script>
        const PITCH_LENGTH = 105, PITCH_WIDTH = 68;
        let canvas, ctx, scale, offsetX, offsetY;
        let dragging = null;

        // Example data - same as the command line output
        const state = {
            ball: { x: -5, y: 0 },
            players: [
                // Team A (blue)
                {id:1,team:0,x:-45,y:0},{id:2,team:0,x:-30,y:-20},{id:3,team:0,x:-32,y:-5},
                {id:4,team:0,x:-32,y:5},{id:5,team:0,x:-30,y:20},{id:6,team:0,x:-10,y:-15},
                {id:7,team:0,x:-5,y:0},{id:8,team:0,x:-10,y:15},{id:9,team:0,x:20,y:-12},
                {id:10,team:0,x:25,y:5},{id:11,team:0,x:18,y:18},
                // Team B (red)
                {id:1,team:1,x:45,y:0},{id:2,team:1,x:30,y:-22},{id:3,team:1,x:32,y:-8},
                {id:4,team:1,x:33,y:3},{id:5,team:1,x:30,y:18},{id:6,team:1,x:15,y:-10},
                {id:7,team:1,x:10,y:5},{id:8,team:1,x:12,y:15},{id:9,team:1,x:-15,y:-5},
                {id:10,team:1,x:-20,y:10},{id:11,team:1,x:-25,y:0}
            ],
            gaps: [
                {x:31,y:5,size:26.1,exploitable:true,xg:0.135},
                {x:30,y:-2,size:40,exploitable:true,xg:0.114},
                {x:39,y:1.5,size:12.4,exploitable:false,xg:0.375}
            ],
            options: [
                {action:'PASS',target:10,x:25,y:5,success:0.53,xg_gain:0.064,ev:-0.0036,rec:'AVOID'},
                {action:'THROUGH',target:null,x:31,y:5,success:0.39,xg_gain:0.111,ev:-0.0089,rec:'AVOID'},
                {action:'PASS',target:9,x:20,y:-12,success:0.57,xg_gain:0.034,ev:-0.0139,rec:'AVOID'}
            ],
            best: {x:25,y:5,success:0.53,ev:-0.0036}
        };

        document.addEventListener('DOMContentLoaded', () => {
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            resize();
            window.addEventListener('resize', resize);
            canvas.addEventListener('click', onClick);
            canvas.addEventListener('mousedown', onMouseDown);
            canvas.addEventListener('mousemove', onMouseMove);
            canvas.addEventListener('mouseup', () => dragging = null);
            updatePanel();
        });

        function resize() {
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            const sx = (canvas.width - 20) / PITCH_LENGTH;
            const sy = (canvas.height - 20) / PITCH_WIDTH;
            scale = Math.min(sx, sy);
            offsetX = (canvas.width - PITCH_LENGTH * scale) / 2;
            offsetY = (canvas.height - PITCH_WIDTH * scale) / 2;
            render();
        }

        function toCanvas(x, y) {
            return {
                x: offsetX + (x + PITCH_LENGTH/2) * scale,
                y: offsetY + (PITCH_WIDTH/2 - y) * scale
            };
        }

        function toPitch(cx, cy) {
            return {
                x: (cx - offsetX) / scale - PITCH_LENGTH/2,
                y: PITCH_WIDTH/2 - (cy - offsetY) / scale
            };
        }

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawPitch();
            if (document.getElementById('showGaps').checked) drawGaps();
            if (document.getElementById('showBest').checked) drawBestOption();
            drawPlayers();
            drawBall();
        }

        function drawPitch() {
            const tl = toCanvas(-PITCH_LENGTH/2, PITCH_WIDTH/2);
            const br = toCanvas(PITCH_LENGTH/2, -PITCH_WIDTH/2);
            ctx.fillStyle = '#2d5a27';
            ctx.fillRect(tl.x, tl.y, br.x-tl.x, br.y-tl.y);
            ctx.strokeStyle = 'rgba(255,255,255,0.7)';
            ctx.lineWidth = 2;
            ctx.strokeRect(tl.x, tl.y, br.x-tl.x, br.y-tl.y);
            // Center line
            const c = toCanvas(0, 0);
            ctx.beginPath();
            ctx.moveTo(c.x, tl.y);
            ctx.lineTo(c.x, br.y);
            ctx.stroke();
            // Center circle
            ctx.beginPath();
            ctx.arc(c.x, c.y, 9.15*scale, 0, Math.PI*2);
            ctx.stroke();
            // Boxes
            const bw = 40.3*scale, bd = 16.5*scale;
            ctx.strokeRect(tl.x, c.y-bw/2, bd, bw);
            ctx.strokeRect(br.x-bd, c.y-bw/2, bd, bw);
        }

        function drawPlayers() {
            state.players.forEach(p => {
                const pos = toCanvas(p.x, p.y);
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, 12, 0, Math.PI*2);
                ctx.fillStyle = p.team === 0 ? '#3b82f6' : '#ef4444';
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 10px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(p.id, pos.x, pos.y);
            });
        }

        function drawBall() {
            const pos = toCanvas(state.ball.x, state.ball.y);
            ctx.beginPath();
            ctx.arc(pos.x, pos.y, 8, 0, Math.PI*2);
            ctx.fillStyle = '#fff';
            ctx.fill();
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function drawGaps() {
            state.gaps.forEach(g => {
                const pos = toCanvas(g.x, g.y);
                const r = (g.size/2) * scale * 0.5;
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, r, 0, Math.PI*2);
                ctx.fillStyle = g.exploitable ? 'rgba(74,222,128,0.3)' : 'rgba(251,191,36,0.2)';
                ctx.fill();
                ctx.strokeStyle = g.exploitable ? '#4ade80' : '#fbbf24';
                ctx.setLineDash([5,5]);
                ctx.stroke();
                ctx.setLineDash([]);
            });
        }

        function drawBestOption() {
            const from = toCanvas(state.ball.x, state.ball.y);
            const to = toCanvas(state.best.x, state.best.y);
            ctx.beginPath();
            ctx.moveTo(from.x, from.y);
            ctx.lineTo(to.x, to.y);
            ctx.strokeStyle = '#00d4ff';
            ctx.lineWidth = 3;
            ctx.stroke();
            // Arrowhead
            const angle = Math.atan2(to.y-from.y, to.x-from.x);
            ctx.beginPath();
            ctx.moveTo(to.x, to.y);
            ctx.lineTo(to.x - 15*Math.cos(angle-Math.PI/6), to.y - 15*Math.sin(angle-Math.PI/6));
            ctx.lineTo(to.x - 15*Math.cos(angle+Math.PI/6), to.y - 15*Math.sin(angle+Math.PI/6));
            ctx.closePath();
            ctx.fillStyle = '#00d4ff';
            ctx.fill();
            // Label
            ctx.fillStyle = '#00d4ff';
            ctx.font = 'bold 12px sans-serif';
            ctx.fillText((state.best.success*100).toFixed(0)+'%', (from.x+to.x)/2, (from.y+to.y)/2-10);
        }

        function onClick(e) {
            const rect = canvas.getBoundingClientRect();
            const p = toPitch(e.clientX-rect.left, e.clientY-rect.top);
            if (Math.abs(p.x) <= PITCH_LENGTH/2 && Math.abs(p.y) <= PITCH_WIDTH/2) {
                state.ball.x = p.x;
                state.ball.y = p.y;
                document.getElementById('ballPos').textContent = `(${p.x.toFixed(1)}, ${p.y.toFixed(1)})`;
                render();
            }
        }

        function onMouseDown(e) {
            const rect = canvas.getBoundingClientRect();
            const cx = e.clientX - rect.left, cy = e.clientY - rect.top;
            state.players.forEach(p => {
                const pos = toCanvas(p.x, p.y);
                if (Math.sqrt((cx-pos.x)**2 + (cy-pos.y)**2) < 15) {
                    dragging = p;
                }
            });
        }

        function onMouseMove(e) {
            if (!dragging) return;
            const rect = canvas.getBoundingClientRect();
            const p = toPitch(e.clientX-rect.left, e.clientY-rect.top);
            dragging.x = Math.max(-PITCH_LENGTH/2, Math.min(PITCH_LENGTH/2, p.x));
            dragging.y = Math.max(-PITCH_WIDTH/2, Math.min(PITCH_WIDTH/2, p.y));
            render();
        }

        function updatePanel() {
            let gapsHtml = '';
            state.gaps.forEach((g,i) => {
                gapsHtml += `<div class="gap-item ${g.exploitable?'exploitable':''}">
                    <strong>Gap ${i+1}</strong> ${g.exploitable?'✓ EXPLOITABLE':'✗ Covered'}<br>
                    <small>Size: ${g.size.toFixed(1)}m | xG: ${g.xg.toFixed(3)}</small>
                </div>`;
            });
            document.getElementById('gapsList').innerHTML = gapsHtml;

            let optsHtml = '';
            state.options.forEach(o => {
                optsHtml += `<div class="option-item">
                    <div class="option-header">
                        <span class="option-type">${o.action}${o.target?' → #'+o.target:''}</span>
                        <span class="option-rec ${o.rec}">${o.rec}</span>
                    </div>
                    <div class="option-stats">
                        <span>Success: ${(o.success*100).toFixed(0)}%</span>
                        <span>xG Gain: +${o.xg_gain.toFixed(3)}</span>
                        <span>EV: ${o.ev.toFixed(4)}</span>
                    </div>
                </div>`;
            });
            document.getElementById('optionsList').innerHTML = optsHtml;
        }

        function analyze() { alert('Analysis runs automatically. Move ball or players to see changes.'); }
        function reset() { location.reload(); }
    </script>
</body>
</html>
